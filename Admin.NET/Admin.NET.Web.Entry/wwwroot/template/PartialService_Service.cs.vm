// Admin.NET é¡¹ç›®çš„ç‰ˆæƒã€å•†æ ‡ã€ä¸“åˆ©å’Œå…¶ä»–ç›¸å…³æƒåˆ©å‡å—ç›¸åº”æ³•å¾‹æ³•è§„çš„ä¿æŠ¤ã€‚ä½¿ç”¨æœ¬é¡¹ç›®åº”éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’Œè®¸å¯è¯çš„è¦æ±‚ã€‚
//
// æœ¬é¡¹ç›®ä¸»è¦éµå¾ª MIT è®¸å¯è¯å’Œ Apache è®¸å¯è¯ï¼ˆç‰ˆæœ¬ 2.0ï¼‰è¿›è¡Œåˆ†å‘å’Œä½¿ç”¨ã€‚è®¸å¯è¯ä½äºæºä»£ç æ ‘æ ¹ç›®å½•ä¸­çš„ LICENSE-MIT å’Œ LICENSE-APACHE æ–‡ä»¶ã€‚
//
// ä¸å¾—åˆ©ç”¨æœ¬é¡¹ç›®ä»äº‹å±å®³å›½å®¶å®‰å…¨ã€æ‰°ä¹±ç¤¾ä¼šç§©åºã€ä¾µçŠ¯ä»–äººåˆæ³•æƒç›Šç­‰æ³•å¾‹æ³•è§„ç¦æ­¢çš„æ´»åŠ¨ï¼ä»»ä½•åŸºäºæœ¬é¡¹ç›®äºŒæ¬¡å¼€å‘è€Œäº§ç”Ÿçš„ä¸€åˆ‡æ³•å¾‹çº çº·å’Œè´£ä»»ï¼Œæˆ‘ä»¬ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ï¼

using Microsoft.AspNetCore.Http;
using OfficeOpenXml.FormulaParsing.Excel.Functions.Text;
@{
    string joinTableName = "u";
    Dictionary<string, int> definedObjects = new Dictionary<string, int>();
    bool haveLikeCdt = false;
    string RemoteField="";
    string PKName="";
    foreach (var column in Model.TableField){
        if (column.QueryWhether == "Y" && column.QueryType == "like"){
            haveLikeCdt = true;
        }
        if(column.RemoteVerify){
            RemoteField=@column.PropertyName;
        }
        if(column.ColumnKey == "True"){
            PKName=column.PropertyName;
        }
    }
}
@if(@Model.NameSpace != "Admin.NET.Core"){
@:using Admin.NET.Core;
}

namespace @Model.NameSpace;
/// <summary>
/// æ‰©å±•@(@Model.BusName)æœåŠ¡
/// </summary>
public partial class @(@Model.ClassName)Service
{
   
    /// <summary>
    /// è·å–åˆ—è¡¨ ğŸ”–
    /// </summary>
    /// <param name="input"></param>
    /// <returns></returns>    
    [ApiDescriptionSettings(Name = "GetTreeList", Description = "è·å–åˆ—è¡¨", Order = 1100), HttpPost]
    [DisplayName("è·å–åˆ—è¡¨")]
    public async Task<List<@(@Model.ClassName)Output>> GetTreeList(Page@(@Model.ClassName)Input input)
    {
        @if(Model.TabType=="Tree"){
        @:var list = await @(@Model.ClassName)Mid.GetQuery(_@(@Model.LowerClassName)Rep, input).OrderBuilder(input).ToTreeAsync(u => u.Children, u => u.@(@Model.TreeKey), input.Id);
        @://var list = await @(@Model.ClassName)Mid.GetQuery(_@(@Model.LowerClassName)Rep, input).OrderBuilder(input).ToListAsync();//éæ ‘å½¢ç»“æ„è¡¨

        @:var md = await _@(@Model.LowerClassName)Rep.AsQueryable().Where(u => u.Id == input.Id).Select<@(@Model.ClassName)Output>().FirstAsync();
        @:if (md == null) return list;
        @:
        @:md.Children = list;
        @:list = [md];
        @:return list;
        }else{
        @://return await @(@Model.ClassName)Mid.GetQuery(_@(@Model.LowerClassName)Rep, input).OrderBuilder(input).ToTreeAsync(u => u.Children, u => u.@(@Model.TreeKey), input.Id));//æ ‘å½¢ç»“æ„è¡¨
        @:return await @(@Model.ClassName)Mid.GetQuery(_@(@Model.LowerClassName)Rep, input).OrderBuilder(input).ToListAsync();
        }
    }
    
}
/// <summary>
/// æ‰©å±•@(@Model.BusName)ä¸­é—´ä»¶
/// </summary>
public partial class @(@Model.ClassName)Mid
{

}
@{
string LowerFirstLetter(string text)
{
return text.ToString()[..1].ToLower() + text[1..]; // é¦–å­—æ¯å°å†™
}
}